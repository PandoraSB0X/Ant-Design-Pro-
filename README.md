# 记Ant Design Pro

# Ant Design Pro

> [官方文档](https://pro.ant.design/docs/getting-started-cn)

## 安装（搭建脚手架）

从GitHub仓库中直接安装最新的脚手架代码

```
$ git clone --depth=1 https://github.com/ant-design/ant-design-pro.git my-project
$ cd my-project
```

生成完整的框架，目录结构如下

```
├── config                   # umi 配置，包含路由，构建等配置-----相当于改版之前的common
├── mock                     # 本地模拟数据
├── public
│   └── favicon.png          # Favicon
├── src
│   ├── assets               # 本地静态资源
│   ├── components           # 业务通用组件
│   ├── e2e                  # 集成测试用例
│   ├── layouts              # 通用布局
│   ├── models               # 全局 dva model
│   ├── pages                # 业务页面入口和常用模板------即改版前的routes
│   ├── services             # 后台接口服务
│   ├── utils                # 工具库
│   ├── locales              # 国际化资源
│   ├── global.less          # 全局样式
│   └── global.js            # 全局 JS
├── tests                    # 测试工具
├── README.md
└── package.json
```

## 本地开发

安装依赖包

```
$ npm install
```

依赖包安装完毕之后，开始运行

```
$ npm start
```

启动完成后会自动打开浏览器访问 [http://localhost:8000](http://localhost:8000/)

# 权限管理的概念

> 基于角色的访问控制方法（Role-Based-Access Control，简称RBAC）是目前公认的解决大型企业的统一资源访问控制的有效方法：减少授权管理的复杂性，降低管理开销，灵活的支持企业的安全策略，并对企业的变化有很大的伸缩性。

**RBAC-0是基于角色的访问控制方法的最基础的模型，在原来的“用户-权限”结构中变成 ”用户-角色-权限“结构**

### 用户管理

提供用户账户的创建，编辑，启用，停用，删除的功能，具体依赖于邮箱，手机号或其他信息创建账号，根据公司实际情况而定。

### 角色管理

角色管理包含了用户&角色的关联，角色&权限的关联关联，主要包括：

- 角色的创建、编辑、删除的功能
- 角色下用户的添加和删除
- 角色权限的配置功能（配置该角色具备什么样的权限）

这种结构中，创建不同的角色，将权限直接赋予角色，用户只需要关联角色就可以获得该角色所对应的权限。

- 这样不用每个用户都设置一遍权限，只需要设置角色的权限
- 用户角色变化的时候，比如从技术部转到运营部，只需要将用户的角色变更，相应的权限就会跟着变更

### 功能权限

> 定义人员是否可以访问某个页面

- **菜单级别的权限：可见性**：如果没有权限，则不展示菜单

### 数据权限

> 定义人员在页面中，可以查看的数据的范围（后端会返回数据）

- 比如，查看销售记录的功能，用户A,B都有权限使用，但是A有权看到公司所有人的，B只能看到他自己的。这就涉及数据权限的控制了。
- 数据权限依赖于功能权限，是对功能权限的进一步描述，说明角色在指定的功能点上的数据控制权限。
- 对于数据权限来说，可以根据需要设置多个数据类型字段。（数据类型就是数据中的某一个字段，数据对象即数据类型的值）

### 按钮/字段权限

> 定义人员可以操作的数据，可以查看的字段

- **页面元素级别权限：可操作性**：如果没有该权限，操作时报错，比如点击时提示“对不起，您没有该操作权限”

**分为部门的增删改查与用户的增删改查，配置权限，这样就能加强扩展性，比如取消或者合并某个部门的时候**

# 基于Ant Design Pro2的权限管理

> 目标：权限的维度希望能够控制到按钮层，包括菜单、路由

antd的方案基于角色维度来进行。config设定当前路由的准入角色。权限组建接受当前角色信息，如此判断渲染的内容。

```
如需对某些页面进行权限控制，只须在路由配置文件 router.config.js 中设置 authority 属性即可，代表该路由的准入权限，pro 的路由系统中会默认包裹 Authorized 进行判断处理。
```

缺陷：umi2中基于约定路由的形式。在路由初始化时不能动态配置config。及不能动态修改authority字段。而且基于角色的权限不能满足我们的需求。我们希望精确到用户的权限配置。后端下发菜单，路由以及按钮list。

## 实现

为解决该问题。我们在router.config.js新增code字段。标记路由的唯一code。Routes定义路由层的父级组件。在该组件中进行路由拦截，实现路由级别权限控制。 // config.js

```
[
  { path: '/', component: './pages/index.js' },
  { path: '/list', component: './pages/list.js',code:123, Routes: ['./routes/PrivateRoute.js'] },
]

作者：en1475230123000
链接：https://juejin.im/post/5baeedbe5188255c4834c19d
```

```
// PrivateRoute.js 
if (route.code && menuList && menuList.indexOf(route.code) == -1) {
    router.replace('/exception/403');
  }
```

### 菜单权限

基于pro的菜单方案进行了修改。直接动刀BasicLayout.js,修改原先基于authority字段的菜单逻辑。改至code字段。

### 新增路由管理

路由表由前端提供，路由名称，（包括路由，菜单，以及按钮类型）。后端存至服务端。再有对应的token下发对应的code list。

### 按钮

写个高阶组件封装下button。 over